<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <title>Kullanıcı & İçerik Projeksiyonu</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        .bass-col {
            background-color: #198754 !important;
            color: white !important;
            font-weight: 700;
        }
    </style>
</head>
<body class="container py-5">
    <h1 class="mb-4 text-center">Küre Platformu Kullanıcı ve İçerik Projeksiyonu</h1>

    {% if error %}
    <div class="alert alert-danger">{{ error }}</div>
    {% endif %}

    <form method="POST" class="row g-3">
        <div class="col-md-6">
            <label for="market_size" class="form-label">Pazar Büyüklüğü (Toplam Potansiyel Kullanıcı):</label>
            <input id="market_size" name="market_size" type="number" min="1" required class="form-control"
                   value="{{ form_values.market_size }}" />
            <div class="form-text">Modelin hedeflediği toplam kullanıcı sayısı</div>
        </div>

        <div class="col-md-6">
            <label for="p" class="form-label">Innovator Adoption Rate (%):</label>
            <input id="p" name="p" type="number" step="0.01" min="0" max="100" required class="form-control"
                   value="{{ form_values.p }}" />
            <div class="form-text">Bağımsız olarak ürünü ilk benimseyen kullanıcıların yüzdesi</div>
        </div>

        <div class="col-md-6">
            <label for="q" class="form-label">Imitator Adoption Rate (%):</label>
            <input id="q" name="q" type="number" step="0.01" min="0" max="100" required class="form-control"
                   value="{{ form_values.q }}" />
            <div class="form-text">Mevcut kullanıcılar tarafından etkilenerek ürünü benimseyen kullanıcıların yüzdesi</div>
        </div>

        <div class="col-md-6">
            <label for="writer_ratio" class="form-label">İçerik Üreticisi Oranı (%):</label>
            <input id="writer_ratio" name="writer_ratio" type="number" step="0.1" min="0" max="100" required
                   class="form-control" value="{{ form_values.writer_ratio }}" />
            <div class="form-text">Toplam kullanıcıların yüzde kaçının içerik ürettiği</div>
        </div>

        <div class="col-md-6">
            <label for="daily_posts" class="form-label">Günlük Ortalama İçerik Sayısı:</label>
            <input id="daily_posts" name="daily_posts" type="number" step="0.0001" min="0" required
                   class="form-control" value="{{ form_values.daily_posts }}" />
            <div class="form-text">Bir içerik üreticisinin günlük ortalama ürettiği içerik sayısı</div>
        </div>

        <div class="col-md-6">
            <label for="initial_users" class="form-label">Mevcut Toplam Kullanıcı Sayısı:</label>
            <input id="initial_users" name="initial_users" type="number" min="0" required class="form-control"
                   value="{{ form_values.initial_users }}" />
            <div class="form-text">Model başlangıcında mevcut aktif kullanıcı sayısı</div>
        </div>

        <div class="col-md-6">
            <label for="initial_content" class="form-label">Mevcut Toplam İçerik Sayısı:</label>
            <input id="initial_content" name="initial_content" type="number" min="0" required class="form-control"
                   value="{{ form_values.initial_content }}" />
            <div class="form-text">Model başlangıcında mevcut içerik sayısı</div>
        </div>

        <div class="col-md-6">
            <label for="content_scenario" class="form-label">İçerik Üretim Senaryosu:</label>
            <select id="content_scenario" name="content_scenario" class="form-select" required>
                <option value="realistic" {% if form_values.content_scenario == 'realistic' %}selected{% endif %}>Gerçekçi</option>
                <option value="optimistic" {% if form_values.content_scenario == 'optimistic' %}selected{% endif %}>İyimser</option>
                <option value="pessimistic" {% if form_values.content_scenario == 'pessimistic' %}selected{% endif %}>Kötümser</option>
            </select>
            <div class="form-text">İçerik üretim projeksiyonu için senaryo seçiniz</div>
        </div>

        <div class="col-12 text-center">
            <button type="submit" class="btn btn-primary px-5 mt-3">Hesapla</button>
        </div>
    </form>

    {% if table is not none %}
    <h2 class="mt-5 mb-3 text-center">Projeksiyon Tablosu</h2>
    <div class="table-responsive">
        <table class="table table-striped table-bordered table-hover">
            <thead class="table-dark">
                <tr>
                    <th>Ay</th>
                    <th class="bass-col">Kullanıcı (Bass)</th>
                    <th>Kullanıcı (Logistic)</th>
                    <th>Kullanıcı (Log-Logistic)</th>
                    <th class="bass-col">İçerik (Bass)</th>
                    <th>İçerik (Poisson)</th>
                    <th>İçerik (Lineer)</th>
                    <th>İçerik (Log-Logistic)</th>
                    <th>Aktif (%)</th>
                    <th>Churn (%)</th>
                </tr>
            </thead>
            <tbody>
                {% for row in table.itertuples() %}
                <tr>
                    <td>{{ row.Ay }}</td>
                    <td class="bass-col">{{ row._2 }}</td>
                    <td>{{ row._3 }}</td>
                    <td>{{ row._4 }}</td>
                    <td class="bass-col">{{ row._5 }}</td>
                    <td>{{ row._6 }}</td>
                    <td>{{ row._7 }}</td>
                    <td>{{ row._8 }}</td>
                    <td>{{ row._9 }}</td>
                    <td>{{ row._10 }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="text-center my-3">
        <a href="{{ url_for('download_excel') }}" class="btn btn-success">Excel Dosyasını İndir</a>
    </div>

    <h2 class="mt-5 mb-3 text-center">Projeksiyon Grafikleri</h2>
    <div class="text-center mb-5">
        <img src="{{ url_for('static', filename='graphs/kullanici_projeksiyon.png') }}" class="img-fluid mb-4" alt="Kullanıcı Grafiği">
        <img src="{{ url_for('static', filename='graphs/icerik_projeksiyon.png') }}" class="img-fluid" alt="İçerik Grafiği">
    </div>

    <div class="text-muted small mt-4">
        <p><strong>Modelleme Notu:</strong> Kullanıcı yayılımı <em>Bass Difüzyon Modeli</em> kullanılarak hesaplanmıştır.</p>
        <p>Kaynak: Bass, F. M. (1969). <em>A new product growth for model consumer durables</em>. <strong>Management Science</strong>, 15(5), 215–227. 
            <a href="https://doi.org/10.1287/mnsc.15.5.215" target="_blank">doi:10.1287/mnsc.15.5.215</a></p>
    </div>
    {% endif %}
</body>
</html>
